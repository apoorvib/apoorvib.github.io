<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exosubmoon Simulation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            background-color: #0f172a;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            height: 100%;
        }
        
        #root {
            height: 100%;
        }
        
        .simulation-container {
            height: 100%;
            width: 100%;
            position: relative;
        }
        
        .controls-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(15, 23, 42, 0.8);
            padding: 1rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.1);
            z-index: 100;
            transition: transform 0.3s ease;
            transform: translateY(70%);
        }
        
        .controls-panel:hover,
        .controls-panel.expanded {
            transform: translateY(0);
        }
        
        .controls-handle {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(15, 23, 42, 0.8);
            color: white;
            padding: 5px 20px;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }
        
        .stats-panel {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background-color: rgba(15, 23, 42, 0.8);
            padding: 1rem;
            border-radius: 0.5rem;
            backdrop-filter: blur(10px);
            max-width: 350px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(15, 23, 42, 0.9);
            color: white;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            z-index: 1000;
            display: none;
            max-width: 200px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <div id="tooltip" class="tooltip"></div>
    
    <script type="text/babel">
        // Use the updated ExoSubmoonVisualization component logic here
        // This is a simplified version adapted for standalone HTML
        
        const ExoSubmoonVisualization = () => {
            // Copy all the state, refs, and useEffect hooks from the updated component
            const containerRef = React.useRef(null);
            const rendererRef = React.useRef(null);
            const sceneRef = React.useRef(null);
            const cameraRef = React.useRef(null);
            const controlsRef = React.useRef(null);
            const animationRef = React.useRef(null);
            const starFieldRef = React.useRef(null);
            
            // State management
            const [isPlaying, setIsPlaying] = React.useState(true);
            const [speedMultiplier, setSpeedMultiplier] = React.useState(1);
            const [showOrbits, setShowOrbits] = React.useState(true);
            const [showStabilityZones, setShowStabilityZones] = React.useState(true);
            const [viewMode, setViewMode] = React.useState('standard');
            const [presetMode, setPresetMode] = React.useState('optimal');
            const [isPanelExpanded, setIsPanelExpanded] = React.useState(false);
            
            // System parameters
            const [planetMass, setPlanetMass] = React.useState(25);
            const [moonMass, setMoonMass] = React.useState(0.5);
            const [submoonMass, setSubmoonMass] = React.useState(0.08);
            const [planetRadius, setPlanetRadius] = React.useState(20);
            const [moonRadius, setMoonRadius] = React.useState(3.2);
            const [submoonRadius, setSubmoonRadius] = React.useState(0.5);
            
            // Derived values
            const [planetToMoonRatio, setPlanetToMoonRatio] = React.useState(50);
            const [moonToSubmoonRatio, setMoonToSubmoonRatio] = React.useState(6.25);
            const [hillRadiusMoon, setHillRadiusMoon] = React.useState(0);
            const [hillRadiusSubmoon, setHillRadiusSubmoon] = React.useState(0);
            const [rocheLimit, setRocheLimit] = React.useState(0);
            
            // Stats for display
            const [stats, setStats] = React.useState({
                stability: 'High',
                estimatedLifetime: '> 100 million years',
                tidalForces: 'Weak',
                orbitRatio: '0.16',
                stabilityScore: 85,
                criticalParams: []
            });
            
            // Copy all functions from the updated component
            // Including createStarField, createCelestialBodies, calculateStabilityMetrics, etc.
            
            // Implement all useEffect hooks for initialization, animation, etc.
            
            React.useEffect(() => {
                // Set preset configurations
                if (presetMode === 'optimal') {
                    // Based on research: planet/moon ratio < 60, moon/submoon ratio > 5
                    setPlanetMass(25);
                    setMoonMass(0.5);
                    setSubmoonMass(0.08);
                    setPlanetRadius(20);
                    setMoonRadius(3.2);
                    setSubmoonRadius(0.5);
                } else if (presetMode === 'unstable') {
                    // Unstable configuration: high planet/moon ratio, low moon/submoon ratio
                    setPlanetMass(50);
                    setMoonMass(0.2);
                    setSubmoonMass(0.15);
                    setPlanetRadius(15);
                    setMoonRadius(4.5);
                    setSubmoonRadius(1.2);
                }
            }, [presetMode]);
            
            // Initialize the Three.js scene
            React.useEffect(() => {
                // Initialize scene, camera, renderer
                // This includes all the setup code from the original component
                
                // IMPORTANT: Full implementation of the Three.js scene
                // This should match the logic in the main component's useEffect
            }, []);
            
            // Add tooltip functionality
            const showTooltip = (text, event) => {
                const tooltip = document.getElementById('tooltip');
                if (tooltip) {
                    tooltip.textContent = text;
                    tooltip.style.left = `${event.clientX + 10}px`;
                    tooltip.style.top = `${event.clientY + 10}px`;
                    tooltip.style.display = 'block';
                }
            };
            
            const hideTooltip = () => {
                const tooltip = document.getElementById('tooltip');
                if (tooltip) {
                    tooltip.style.display = 'none';
                }
            };
            
            return (
                <div className="simulation-container">
                    <div ref={containerRef} className="w-full h-full"></div>
                    
                    <div className="stats-panel">
                        <h3 className="text-lg font-bold mb-2">System Stability Analysis</h3>
                        <div className="grid grid-cols-2 gap-2 text-sm">
                            <div>Stability:</div>
                            <div className={`font-bold ${
                                stats.stability === 'High' ? 'text-green-400' : 
                                stats.stability === 'Medium' ? 'text-yellow-400' : 
                                stats.stability === 'Low' ? 'text-orange-400' : 'text-red-400'
                            }`}>
                                {stats.stability}
                            </div>
                            
                            <div>Estimated Lifetime:</div>
                            <div className="font-bold">{stats.estimatedLifetime}</div>
                            
                            <div>Stability Score:</div>
                            <div className={`font-bold ${
                                stats.stabilityScore >= 80 ? 'text-green-400' : 
                                stats.stabilityScore >= 50 ? 'text-yellow-400' : 
                                stats.stabilityScore >= 30 ? 'text-orange-400' : 'text-red-400'
                            }`}>
                                {stats.stabilityScore}/100
                            </div>
                            
                            <div>Planet/Moon Ratio:</div>
                            <div className={`font-bold ${planetToMoonRatio < 60 ? 'text-green-400' : 'text-red-400'}`}>
                                {planetToMoonRatio.toFixed(1)}:1
                            </div>
                            
                            <div>Moon/Submoon Ratio:</div>
                            <div className={`font-bold ${moonToSubmoonRatio > 5 ? 'text-green-400' : 'text-red-400'}`}>
                                {moonToSubmoonRatio.toFixed(1)}:1
                            </div>
                        </div>
                        
                        {stats.criticalParams.length > 0 && (
                            <div className="mt-3 p-2 bg-red-900 bg-opacity-50 rounded">
                                <h4 className="font-bold text-xs uppercase mb-1">Critical Issues:</h4>
                                <ul className="text-xs">
                                    {stats.criticalParams.map((param, index) => (
                                        <li key={index} className="flex items-center">
                                            <span className="text-red-400 mr-1">•</span> {param}
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        )}
                    </div>
                    
                    <div className={`controls-panel ${isPanelExpanded ? 'expanded' : ''}`}>
                        <div className="controls-handle" onClick={() => setIsPanelExpanded(!isPanelExpanded)}>
                            <i className={`fas fa-chevron-${isPanelExpanded ? 'down' : 'up'} mr-2`}></i>
                            Controls
                        </div>
                        
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            {/* System parameters */}
                            <div className="space-y-3">
                                <h3 className="text-md font-bold text-white mb-2">System Parameters</h3>
                                
                                <div className="space-y-1">
                                    <label className="text-gray-300 text-sm flex justify-between">
                                        <span>Planet Mass: {planetMass} M<sub>jup</sub></span>
                                    </label>
                                    <input
                                        type="range"
                                        min="5"
                                        max="100"
                                        value={planetMass}
                                        onChange={(e) => setPlanetMass(Number(e.target.value))}
                                        className="w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer"
                                        onMouseOver={(e) => showTooltip('Planet mass affects Hill radius and stability', e)}
                                        onMouseOut={hideTooltip}
                                    />
                                </div>
                                
                                <div className="space-y-1">
                                    <label className="text-gray-300 text-sm flex justify-between">
                                        <span>Moon Mass: {moonMass} M<sub>jup</sub></span>
                                        <span className={`${planetToMoonRatio < 60 ? 'text-green-400' : 'text-red-400'} text-xs`}>
                                            {planetToMoonRatio < 60 ? '✓ Optimal Ratio' : '✗ Too small'}
                                        </span>
                                    </label>
                                    <input
                                        type="range"
                                        min="0.1"
                                        max="10"
                                        step="0.1"
                                        value={moonMass}
                                        onChange={(e) => setMoonMass(Number(e.target.value))}
                                        className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                        onMouseOver={(e) => showTooltip('Optimal planet/moon mass ratio is <60', e)}
                                        onMouseOut={hideTooltip}
                                    />
                                </div>
                                
                                <div className="space-y-1">
                                    <label className="text-gray-300 text-sm flex justify-between">
                                        <span>Submoon Mass: {submoonMass} M<sub>jup</sub></span>
                                        <span className={`${moonToSubmoonRatio > 5 ? 'text-green-400' : 'text-red-400'} text-xs`}>
                                            {moonToSubmoonRatio > 5 ? '✓ Optimal Ratio' : '✗ Too large'}
                                        </span>
                                    </label>
                                    <input
                                        type="range"
                                        min="0.01"
                                        max="1"
                                        step="0.01"
                                        value={submoonMass}
                                        onChange={(e) => setSubmoonMass(Number(e.target.value))}
                                        className="w-full h-2 bg-red-200 rounded-lg appearance-none cursor-pointer"
                                        onMouseOver={(e) => showTooltip('Optimal moon/submoon mass ratio is >5', e)}
                                        onMouseOut={hideTooltip}
                                    />
                                </div>
                            </div>
                            
                            {/* Orbital parameters */}
                            <div className="space-y-3">
                                <h3 className="text-md font-bold text-white mb-2">Orbital Parameters</h3>
                                
                                <div className="space-y-1">
                                    <label className="text-gray-300 text-sm">Planet Orbit: {planetRadius} AU</label>
                                    <input
                                        type="range"
                                        min="10"
                                        max="30"
                                        value={planetRadius}
                                        onChange={(e) => setPlanetRadius(Number(e.target.value))}
                                        className="w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer"
                                    />
                                </div>
                                
                                <div className="space-y-1">
                                    <label className="text-gray-300 text-sm">Moon Orbit: {moonRadius} Hill radii</label>
                                    <input
                                        type="range"
                                        min="0.1"
                                        max="0.7"
                                        step="0.05"
                                        value={moonRadius}
                                        onChange={(e) => setMoonRadius(Number(e.target.value))}
                                        className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                        onMouseOver={(e) => showTooltip('Hill radius is the boundary of gravitational influence', e)}
                                        onMouseOut={hideTooltip}
                                    />
                                </div>
                                
                                <div className="space-y-1">
                                    <label className="text-gray-300 text-sm flex justify-between">
                                        <span>Submoon Orbit: {submoonRadius} Hill radii</span>
                                        <span className={`${
                                            submoonRadius >= 0.4 && submoonRadius <= 0.6 ? 'text-green-400' : 
                                            submoonRadius >= 0.3 && submoonRadius <= 0.7 ? 'text-yellow-400' : 'text-red-400'
                                        } text-xs`}>
                                            {submoonRadius >= 0.4 && submoonRadius <= 0.6 ? '✓ Optimal Zone' : 'Suboptimal'}
                                        </span>
                                    </label>
                                    <input
                                        type="range"
                                        min="0.1"
                                        max="0.9"
                                        step="0.05"
                                        value={submoonRadius}
                                        onChange={(e) => setSubmoonRadius(Number(e.target.value))}
                                        className="w-full h-2 bg-red-200 rounded-lg appearance-none cursor-pointer"
                                        onMouseOver={(e) => showTooltip('Optimal position: 0.4-0.6 Hill radii', e)}
                                        onMouseOut={hideTooltip}
                                    />
                                </div>
                            </div>
                            
                            {/* Simulation controls */}
                            <div className="space-y-3">
                                <h3 className="text-md font-bold text-white mb-2">Simulation Controls</h3>
                                
                                <div className="flex space-x-2 mb-2">
                                    <button 
                                        onClick={() => setIsPlaying(!isPlaying)}
                                        className="px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex-1 flex items-center justify-center text-sm"
                                    >
                                        {isPlaying ? <><i className="fas fa-pause mr-1"></i> Pause</> : <><i className="fas fa-play mr-1"></i> Play</>}
                                    </button>
                                    
                                    <button 
                                        onClick={() => setShowOrbits(!showOrbits)}
                                        className="px-3 py-1 bg-gray-600 text-white rounded-lg hover:bg-gray-700 flex-1 flex items-center justify-center text-sm"
                                    >
                                        {showOrbits ? <><i className="fas fa-eye-slash mr-1"></i> Hide Orbits</> : <><i className="fas fa-eye mr-1"></i> Show Orbits</>}
                                    </button>
                                </div>
                                
                                <div className="flex space-x-2 mb-2">
                                    <button 
                                        onClick={() => setShowStabilityZones(!showStabilityZones)}
                                        className={`px-3 py-1 text-sm ${showStabilityZones ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-600 hover:bg-gray-700'} text-white rounded-lg flex-1 flex items-center justify-center`}
                                    >
                                        {showStabilityZones ? <><i className="fas fa-chart-area mr-1"></i> Hide Zones</> : <><i className="fas fa-chart-area mr-1"></i> Show Zones</>}
                                    </button>
                                </div>
                                
                                <div className="grid grid-cols-2 gap-1 mb-2">
                                    <div className="space-y-1">
                                        <label className="text-gray-300 text-xs">Speed: {speedMultiplier}x</label>
                                        <input
                                            type="range"
                                            min="0.1"
                                            max="5"
                                            step="0.1"
                                            value={speedMultiplier}
                                            onChange={(e) => setSpeedMultiplier(Number(e.target.value))}
                                            className="w-full h-2 bg-green-200 rounded-lg appearance-none cursor-pointer"
                                        />
                                    </div>
                                    
                                    <div className="space-y-1">
                                        <label className="text-gray-300 text-xs">View Mode:</label>
                                        <select 
                                            value={viewMode}
                                            onChange={(e) => setViewMode(e.target.value)}
                                            className="w-full bg-gray-700 text-white rounded-lg text-xs p-1"
                                        >
                                            <option value="standard">Free View</option>
                                            <option value="topDown">Top Down</option>
                                            <option value="planet">Planet View</option>
                                            <option value="moon">Moon View</option>
                                            <option value="educational">Educational</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div className="space-y-1">
                                    <label className="text-gray-300 text-xs">Presets:</label>
                                    <div className="grid grid-cols-3 gap-1">
                                        <button 
                                            onClick={() => setPresetMode('optimal')}
                                            className={`px-2 py-1 rounded-lg text-xs ${presetMode === 'optimal' ? 'bg-green-600 text-white' : 'bg-gray-700 text-gray-300'}`}
                                        >
                                            Optimal
                                        </button>
                                        <button 
                                            onClick={() => setPresetMode('unstable')}
                                            className={`px-2 py-1 rounded-lg text-xs ${presetMode === 'unstable' ? 'bg-red-600 text-white' : 'bg-gray-700 text-gray-300'}`}
                                        >
                                            Unstable
                                        </button>
                                        <button 
                                            onClick={() => setPresetMode('custom')}
                                            className={`px-2 py-1 rounded-lg text-xs ${presetMode === 'custom' ? 'bg-blue-600 text-white' : 'bg-gray-700 text-gray-300'}`}
                                        >
                                            Custom
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Render the component
        ReactDOM.render(<ExoSubmoonVisualization />, document.getElementById('root'));
    </script>
</body>
</html>